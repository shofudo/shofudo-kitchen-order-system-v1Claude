<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ã‚­ãƒƒãƒãƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            background: #f5f5f5;
            color: #333;
            padding: 10px;
            overflow-x: hidden;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        .header {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .last-update {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ - ã‚ˆã‚Šå¤šãã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º */
        .dish-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        /* ã‚«ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        .dish-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12);
            border: 2px solid #3498db;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        .dish-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 3px solid #3498db;
        }

        .dish-name-container {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .dish-name {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            line-height: 1.2;
        }

        .dish-furigana {
            font-size: 24px;
            font-weight: bold;
            color: #7f8c8d;
            line-height: 1.2;
        }

        .dish-total {
            font-size: 40px;
            font-weight: bold;
            color: #e74c3c;
            background: #ffe6e6;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
            min-width: 100px;
            text-align: center;
        }

        /* æ³¨æ–‡ãƒªã‚¹ãƒˆã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        .order-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* å„æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        .order-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        /* ã‚¢ã‚¤ãƒ†ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¿ã‚°ã‚’æ¨ªä¸¦ã³ã«é…ç½® */
        .item-header {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }

        /* éƒ¨å±‹åè¡¨ç¤º - å°ã•ã‚ã®è£œè¶³æƒ…å ±ã¨ã—ã¦ */
        .room-names {
            font-size: 14px;
            color: #666;
            font-weight: normal;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .room-name-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .room-icon {
            font-size: 14px;
        }

        /* å„ã‚¿ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ« - ã‚ˆã‚Šå¤§ããç›®ç«‹ã¤ã‚ˆã†ã« */
        .detail-tag {
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        /* ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã‚¿ã‚° - èµ¤è‰²ã§ç›®ç«‹ã¤ã‚ˆã†ã« */
        .allergy-tag {
            background: #ff6b6b;
            color: white;
            border: 3px solid #c92a2a;
            font-size: 20px;
        }

        /* ç«å…¥ã‚Œã‚¿ã‚°(WÃ—2ãªã©) - ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã§ç›®ç«‹ã¤ã‚ˆã†ã« */
        .w-tag {
            background: #ffa94d;
            color: #fff;
            border: 3px solid #ff8c00;
            font-size: 20px;
        }

        /* æ‹…å½“è€…ã‚¿ã‚° */
        .staff-tag {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        /* ç©ºã®çŠ¶æ…‹ */
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .empty-state h2 {
            font-size: 32px;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .empty-state p {
            font-size: 20px;
            color: #7f8c8d;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width: 768px) {
            .dish-grid {
                grid-template-columns: 1fr;
            }
            
            .dish-name {
                font-size: 24px;
            }
            
            .dish-furigana {
                font-size: 20px;
            }
            
            .dish-total {
                font-size: 32px;
            }
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
        }

        .loading-spinner {
            border: 6px solid #e0e0e0;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ³ ã‚­ãƒƒãƒãƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤</h1>
        <div class="last-update" id="last-update">æ¥ç¶šä¸­...</div>
    </div>

    <div id="content">
        <div class="loading">
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        // æ–™ç†åã®ãµã‚ŠãŒãªå¯¾å¿œè¡¨
        const COURSE_FURIGANA = {
            "å¸ç‰©": "ã™ã„ã‚‚ã®",
            "æœèœç››ã‚Š": "ã‹ã•ã„ã‚‚ã‚Š",
            "è’¸ç‰©": "ã‚€ã—ã‚‚ã®",
            "æšç‰©": "ã‚ã’ã‚‚ã®",
            "ç…®ç‰©": "ã«ã‚‚ã®",
            "ã”é£¯": "ã”ã¯ã‚“",
            "ç”˜å‘³": "ã‹ã‚“ã¿",
            "ã™ãç„¼ã": "ã™ãã‚„ã",
            "ãƒ•ãƒ©ã‚¤": "ãµã‚‰ã„",
            "ã‚¹ãƒ†ãƒ¼ã‚­": "ã™ã¦ãƒ¼ã",
            "é‹": "ãªã¹",
            "é®‘": "ã‚ã‚ã³"
        };

        // éƒ¨å±‹ã®è¡¨ç¤ºé †åº
        const ROOM_ORDER = ["ã‚„ã¾ã¶ã", "ã‚ã™ã‚Œãªè‰", "ã—ã‚ƒããªã’", "ã‚ã‚“ãš", "ãªã¤ã‚"];

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyAoyApbQzAlSYsM1MBDPZ68I5EaJ3M_yE8",
            authDomain: "restaurant-order-system-8855a.firebaseapp.com",
            databaseURL: "https://restaurant-order-system-8855a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "restaurant-order-system-8855a",
            storageBucket: "restaurant-order-system-8855a.firebasestorage.app",
            messagingSenderId: "695114713080",
            appId: "1:695114713080:web:de13ca2e7e448e92fb380d"
        };

        // FirebaseåˆæœŸåŒ–
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const ordersRef = ref(database, 'orders');

        // å‰å›ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä¿æŒ(é€šçŸ¥éŸ³ç”¨)
        let previousOrderStatuses = {};

        // åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒ©ã‚°
        let initialDataLoaded = false;

        // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š(10ç§’ä»¥å†…ã«ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤º)
        const loadingTimeout = setTimeout(() => {
            if (!initialDataLoaded) {
                showError('æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ', 'Firebaseã¸ã®æ¥ç¶šã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }, 10000);

        // AudioContextã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§1ã¤ã ã‘ä¿æŒ(iOS Safariå¯¾ç­–)
        let audioContext = null;
        let audioInitialized = false;

        // åˆå›èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§éŸ³å£°ã‚’æœ‰åŠ¹åŒ–
        document.addEventListener('click', function initAudio() {
            if (!audioInitialized) {
                try {
                    // AudioContextã‚’1å›ã ã‘ä½œæˆã—ã¦ä¿æŒ
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    audioContext.resume().then(() => {
                        audioInitialized = true;
                        console.log('éŸ³å£°ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ - AudioContext ready');
                    });
                } catch (error) {
                    console.error('éŸ³å£°ã®åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
        }, { once: true });

        // é€šçŸ¥éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
        function playNotificationSound() {
            console.log('é€šçŸ¥éŸ³ã‚’å†ç”Ÿã—ã¾ã™');

            // AudioContextãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å†ç”Ÿã—ãªã„
            if (!audioContext || !audioInitialized) {
                console.warn('AudioContextãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                // æ—¢å­˜ã®AudioContextã‚’å†åˆ©ç”¨
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800; // 800Hzã®ãƒ“ãƒ¼ãƒ—éŸ³
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
                
                console.log('é€šçŸ¥éŸ³ã‚’å†ç”Ÿã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('é€šçŸ¥éŸ³ã®å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–
        onValue(ordersRef, (snapshot) => {
            // åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ
            if (!initialDataLoaded) {
                initialDataLoaded = true;
                clearTimeout(loadingTimeout);
                console.log('Firebaseæ¥ç¶šæˆåŠŸ');
            }
            
            const orderData = snapshot.val();
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã‚’æ¤œå‡ºã—ã¦é€šçŸ¥éŸ³ã‚’é³´ã‚‰ã™
            checkForNewOrders(orderData);
            
            updateDisplay(orderData);
            updateLastUpdate();
        }, (error) => {
            console.error('Firebaseã‚¨ãƒ©ãƒ¼:', error);
            clearTimeout(loadingTimeout);
            
            // ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            if (error.code === 'PERMISSION_DENIED') {
                showError('æ¨©é™ã‚¨ãƒ©ãƒ¼', 'Firebaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Database Rulesã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            } else if (error.code === 'NETWORK_ERROR') {
                showError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            } else {
                showError('æ¥ç¶šã‚¨ãƒ©ãƒ¼', `Firebaseã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${error.code || 'ä¸æ˜'}`);
            }
        });

        // æ–°ã—ã„ã€Œæ³¨ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ¤œå‡º
        function checkForNewOrders(orderData) {
            if (!orderData) return;

            let hasNewOrder = false;

            Object.entries(orderData).forEach(([roomName, roomData]) => {
                if (!roomData.courses) return;

                Object.entries(roomData.courses).forEach(([courseName, courseData]) => {
                    const key = `${roomName}_${courseName}`;
                    const currentStatus = courseData.status;
                    const previousStatus = previousOrderStatuses[key];

                    // ä»¥å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå­˜åœ¨ã—ã€ã‹ã¤ã€Œorderã€ä»¥å¤–ã‹ã‚‰ã€Œorderã€ã«å¤‰ã‚ã£ãŸå ´åˆ
                    if (previousStatus && previousStatus !== 'order' && currentStatus === 'order') {
                        hasNewOrder = true;
                        console.log(`æ–°ã—ã„æ³¨æ–‡ã‚’æ¤œå‡º: ${roomName} - ${courseName}`);
                    }

                    // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä¿å­˜
                    previousOrderStatuses[key] = currentStatus;
                });
            });

            if (hasNewOrder) {
                playNotificationSound();
            }
        }

        // æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’è¡¨ç¤º
        function updateLastUpdate() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('last-update').textContent = `æœ€çµ‚æ›´æ–°: ${timeStr}`;
        }

        // éƒ¨å±‹åã‚’ä¸¦ã³æ›¿ãˆã‚‹é–¢æ•°
        function sortRoomsByOrder(rooms) {
            return rooms.sort((a, b) => {
                const indexA = ROOM_ORDER.indexOf(a.roomName);
                const indexB = ROOM_ORDER.indexOf(b.roomName);
                
                // ä¸¡æ–¹ã¨ã‚‚å®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é †åºã§æ¯”è¼ƒ
                if (indexA !== -1 && indexB !== -1) {
                    return indexA - indexB;
                }
                // ç‰‡æ–¹ã ã‘å®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€å®šç¾©ã•ã‚Œã¦ã„ã‚‹æ–¹ã‚’å‰ã«
                if (indexA !== -1) return -1;
                if (indexB !== -1) return 1;
                // ã©ã¡ã‚‰ã‚‚å®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã¯åå‰ã§æ¯”è¼ƒ
                return a.roomName.localeCompare(b.roomName, 'ja');
            });
        }

        // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’æ›´æ–°
        function updateDisplay(orderData) {
            const content = document.getElementById('content');
            
            if (!orderData) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h2>ğŸ“‹ æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</h2>
                        <p>iPadã§æ³¨æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                    </div>
                `;
                return;
            }

            // æ–™ç†ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const dishGroups = {};
            
            Object.entries(orderData).forEach(([roomName, roomData]) => {
                if (!roomData.courses) return;
                
                Object.entries(roomData.courses).forEach(([courseName, courseData]) => {
                    // ã€Œæ³¨ã€(order)ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ–™ç†ã®ã¿è¡¨ç¤º
                    if (courseData.status !== 'order') return;
                    
                    if (!dishGroups[courseName]) {
                        dishGroups[courseName] = [];
                    }
                    
                    // éƒ¨å±‹ã®è¨­å®šæƒ…å ±ã‚’å–å¾—(localStorageã‹ã‚‰ - äººæ•°ã®ã¿)
                    const settings = JSON.parse(localStorage.getItem('orderSettings') || '{}');
                    let roomSettings = null;
                    
                    if (settings.rooms) {
                        roomSettings = settings.rooms.find(r => r.name === roomName);
                    }
                    if (!roomSettings && settings.customRooms) {
                        roomSettings = settings.customRooms.find(r => r.name === roomName);
                    }
                    
                    const people = roomSettings ? roomSettings.people : 2;
                    // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã¯Firebaseã‹ã‚‰å–å¾—
                    const allergy = courseData.allergy || '';
                    
                    dishGroups[courseName].push({
                        roomName: roomName,
                        people: people,
                        allergy: allergy,
                        wCount: courseData.wCount || 0,
                        staff: courseData.staff,
                        pressedTime: courseData.pressedTime
                    });
                });
            });

            // è¡¨ç¤ºã‚’æ§‹ç¯‰
            if (Object.keys(dishGroups).length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h2>âœ… å…¨ã¦ã®æ³¨æ–‡ãŒå‡¦ç†æ¸ˆã¿ã§ã™</h2>
                        <p>æ–°ã—ã„æ³¨æ–‡ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="dish-grid">';
            
            Object.entries(dishGroups).forEach(([dishName, orders]) => {
                // éƒ¨å±‹ã®é †åºã§ã‚½ãƒ¼ãƒˆ
                const sortedOrders = sortRoomsByOrder(orders);
                const totalPeople = sortedOrders.reduce((sum, order) => sum + order.people, 0);
                
                // ãµã‚ŠãŒãªã‚’å–å¾—
                const furigana = COURSE_FURIGANA[dishName] || '';
                
                html += `
                    <div class="dish-card">
                        <div class="dish-header">
                            <div class="dish-name-container">
                                <div class="dish-name">${dishName}</div>
                                ${furigana ? `<div class="dish-furigana">${furigana}</div>` : ''}
                            </div>
                            <div class="dish-total">${totalPeople}å</div>
                        </div>
                        <div class="order-list">
                `;
                
                // è©³ç´°æƒ…å ±(ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»ç«å…¥ã‚Œãƒ»æ‹…å½“è€…)ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
                const groupedOrders = {};
                sortedOrders.forEach(order => {
                    const key = `${order.allergy || 'none'}_${order.wCount}_${order.staff || 'none'}`;
                    if (!groupedOrders[key]) {
                        groupedOrders[key] = {
                            rooms: [],
                            allergy: order.allergy,
                            wCount: order.wCount,
                            staff: order.staff
                        };
                    }
                    groupedOrders[key].rooms.push(order.roomName);
                });
                
                // å„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¡¨ç¤º
                Object.values(groupedOrders).forEach(group => {
                    html += `<div class="order-item">`;
                    
                    // ã‚¿ã‚°ã‚’å…ˆã«è¡¨ç¤º(ç«å…¥ã‚Œãƒ»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼)
                    const tags = [];
                    
                    // ç«å…¥ã‚Œã‚¿ã‚°(WÃ—2ãªã©) - æœ€å„ªå…ˆã§è¡¨ç¤º
                    if (group.wCount > 0) {
                        tags.push(`
                            <span class="detail-tag w-tag">
                                ğŸ”¥ WÃ—${group.wCount}
                            </span>
                        `);
                    }
                    
                    // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã‚¿ã‚° - 2ç•ªç›®ã«è¡¨ç¤º
                    if (group.allergy) {
                        tags.push(`
                            <span class="detail-tag allergy-tag">
                                ${group.allergy}NG
                            </span>
                        `);
                    }
                    
                    // æ‹…å½“è€…ã‚¿ã‚°
                    if (group.staff) {
                        tags.push(`
                            <span class="detail-tag staff-tag">
                                ğŸ‘¤ ${group.staff}
                            </span>
                        `);
                    }
                    
                    // ã‚¿ã‚°ãŒã‚ã‚‹å ´åˆã€item-headerã§è¡¨ç¤º
                    if (tags.length > 0) {
                        html += `<div class="item-header">${tags.join('')}</div>`;
                    }
                    
                    // éƒ¨å±‹åã‚’å°ã•ãæ¨ªä¸¦ã³ã§è¡¨ç¤º
                    html += `<div class="room-names">`;
                    group.rooms.forEach(roomName => {
                        html += `
                            <div class="room-name-item">
                                <span class="room-icon">ğŸ </span>
                                ${roomName}
                            </div>
                        `;
                    });
                    html += `</div>`;
                    
                    html += '</div>';
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(title = 'æ¥ç¶šã‚¨ãƒ©ãƒ¼', message = 'Firebaseã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ') {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="empty-state">
                    <h2>âŒ ${title}</h2>
                    <p>${message}</p>
                    <p style="margin-top: 15px; font-size: 18px;">ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„</p>
                    <button onclick="location.reload()" style="
                        margin-top: 20px;
                        padding: 15px 30px;
                        font-size: 18px;
                        font-weight: bold;
                        background: #3498db;
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
                    ">ğŸ”„ å†èª­ã¿è¾¼ã¿</button>
                </div>
            `;
        }
    </script>
</body>
</html>
