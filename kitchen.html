<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>„Ç≠„ÉÉ„ÉÅ„É≥„Éá„Ç£„Çπ„Éó„É¨„Ç§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 15px;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .last-update {
            font-size: 16px;
            color: #ecf0f1;
            opacity: 0.8;
        }

        .dish-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .dish-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            animation: fadeIn 0.5s ease-in;
        }

        .dish-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dish-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }

        .dish-name {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }

        .dish-total {
            font-size: 36px;
            font-weight: bold;
            color: #e74c3c;
            background: #ffe6e6;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
        }

        .order-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .order-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            border-left: 5px solid #3498db;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .order-header-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .room-name {
            font-size: 16px;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .room-icon {
            font-size: 14px;
        }

        .order-people {
            font-size: 26px;
            font-weight: bold;
            color: #2c3e50;
        }

        .order-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }

        .detail-tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .allergy-tag {
            background: #fee;
            color: #c0392b;
            border: 2px solid #e74c3c;
        }

        .w-tag {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .time-tag {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #17a2b8;
        }

        .staff-tag {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .empty-state h2 {
            font-size: 28px;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .empty-state p {
            font-size: 18px;
            opacity: 0.6;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñË™øÊï¥ */
        @media (max-width: 768px) {
            .dish-grid {
                grid-template-columns: 1fr;
            }
            
            .dish-name {
                font-size: 24px;
            }
            
            .dish-total {
                font-size: 28px;
            }
            
            .order-people {
                font-size: 22px;
            }
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .loading-spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üç≥ „Ç≠„ÉÉ„ÉÅ„É≥„Éá„Ç£„Çπ„Éó„É¨„Ç§</h1>
        <div class="last-update" id="last-update">Êé•Á∂ö‰∏≠...</div>
    </div>

    <div id="content">
        <div class="loading">
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        // FirebaseË®≠ÂÆö
        const firebaseConfig = {
            apiKey: "AIzaSyAoyApbQzAlSYsM1MBDPZ68I5EaJ3M_yE8",
            authDomain: "restaurant-order-system-8855a.firebaseapp.com",
            databaseURL: "https://restaurant-order-system-8855a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "restaurant-order-system-8855a",
            storageBucket: "restaurant-order-system-8855a.firebasestorage.app",
            messagingSenderId: "695114713080",
            appId: "1:695114713080:web:de13ca2e7e448e92fb380d"
        };

        // FirebaseÂàùÊúüÂåñ
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const ordersRef = ref(database, 'orders');

        // Ê≥®Êñá„Éá„Éº„Çø„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÁõ£Ë¶ñ
        onValue(ordersRef, (snapshot) => {
            const orderData = snapshot.val();
            updateDisplay(orderData);
            updateLastUpdate();
        }, (error) => {
            console.error('Firebase„Ç®„É©„Éº:', error);
            showError();
        });

        // ÊúÄÁµÇÊõ¥Êñ∞ÊôÇÂàª„ÇíË°®Á§∫
        function updateLastUpdate() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('last-update').textContent = `ÊúÄÁµÇÊõ¥Êñ∞: ${timeStr}`;
        }

        // „Éá„Ç£„Çπ„Éó„É¨„Ç§„ÇíÊõ¥Êñ∞
        function updateDisplay(orderData) {
            const content = document.getElementById('content');
            
            if (!orderData) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h2>üìã Ê≥®Êñá„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h2>
                        <p>iPad„ÅßÊ≥®Êñá„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                `;
                return;
            }

            // ÊñôÁêÜ„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const dishGroups = {};
            
            Object.entries(orderData).forEach(([roomName, roomData]) => {
                if (!roomData.courses) return;
                
                Object.entries(roomData.courses).forEach(([courseName, courseData]) => {
                    // „ÄåÊ≥®„Äç(order)„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÊñôÁêÜ„ÅÆ„ÅøË°®Á§∫
                    if (courseData.status !== 'order') return;
                    
                    if (!dishGroups[courseName]) {
                        dishGroups[courseName] = [];
                    }
                    
                    // ÈÉ®Â±ã„ÅÆË®≠ÂÆöÊÉÖÂ†±„ÇíÂèñÂæó(localStorage„Åã„Çâ)
                    const settings = JSON.parse(localStorage.getItem('orderSettings') || '{}');
                    let roomSettings = null;
                    
                    if (settings.rooms) {
                        roomSettings = settings.rooms.find(r => r.name === roomName);
                    }
                    if (!roomSettings && settings.customRooms) {
                        roomSettings = settings.customRooms.find(r => r.name === roomName);
                    }
                    
                    const people = roomSettings ? roomSettings.people : 2;
                    const allergy = roomSettings && roomSettings.allergies ? 
                        roomSettings.allergies[courseName] : null;
                    
                    dishGroups[courseName].push({
                        roomName: roomName,
                        people: people,
                        allergy: allergy,
                        wCount: courseData.wCount || 0,
                        time: courseData.time,
                        staff: courseData.staff,
                        pressedTime: courseData.pressedTime
                    });
                });
            });

            // Ë°®Á§∫„ÇíÊßãÁØâ
            if (Object.keys(dishGroups).length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h2>‚úÖ ÂÖ®„Å¶„ÅÆÊ≥®Êñá„ÅåÂá¶ÁêÜÊ∏à„Åø„Åß„Åô</h2>
                        <p>Êñ∞„Åó„ÅÑÊ≥®Êñá„Çí„ÅäÂæÖ„Å°„Åó„Å¶„ÅÑ„Åæ„Åô</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="dish-grid">';
            
            Object.entries(dishGroups).forEach(([dishName, orders]) => {
                const totalPeople = orders.reduce((sum, order) => sum + order.people, 0);
                
                html += `
                    <div class="dish-card">
                        <div class="dish-header">
                            <div class="dish-name">${dishName}</div>
                            <div class="dish-total">${totalPeople}Âêç</div>
                        </div>
                        <div class="order-list">
                `;
                
                orders.forEach(order => {
                    html += `
                        <div class="order-item">
                            <div class="order-header-line">
                                <div class="room-name">
                                    <span class="room-icon">üè†</span>
                                    ${order.roomName}
                                </div>
                                <div class="order-people">${order.people}Âêç</div>
                            </div>
                    `;
                    
                    // Ë©≥Á¥∞„Çø„Ç∞
                    const details = [];
                    
                    if (order.allergy) {
                        details.push(`
                            <span class="detail-tag allergy-tag">
                                ‚ö†Ô∏è ${order.allergy}
                            </span>
                        `);
                    }
                    
                    if (order.wCount > 0) {
                        details.push(`
                            <span class="detail-tag w-tag">
                                üî• W√ó${order.wCount}
                            </span>
                        `);
                    }
                    
                    if (order.time) {
                        details.push(`
                            <span class="detail-tag time-tag">
                                üïê ${order.time}
                            </span>
                        `);
                    }
                    
                    if (order.staff) {
                        details.push(`
                            <span class="detail-tag staff-tag">
                                üë§ ${order.staff}
                            </span>
                        `);
                    }
                    
                    if (details.length > 0) {
                        html += `<div class="order-details">${details.join('')}</div>`;
                    }
                    
                    html += '</div>';
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // „Ç®„É©„ÉºË°®Á§∫
        function showError() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="empty-state">
                    <h2>‚ùå Êé•Á∂ö„Ç®„É©„Éº</h2>
                    <p>Firebase„Å∏„ÅÆÊé•Á∂ö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>
                    <p style="margin-top: 10px; font-size: 14px;">„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                </div>
            `;
        }
    </script>
</body>
</html>
